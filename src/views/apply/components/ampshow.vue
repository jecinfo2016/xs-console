<template>
  <div class="ampshow">
    <el-button type="text" @click="back()">《 返回</el-button>
    <el-main id="container" style="position:relative;"></el-main>
  </div>
</template>


<script>
import { findGuidesInfo } from "@/api/hydraulic";
import * as L7 from "@antv/l7";
import { Scene, PointLayer, LineLayer, Popup } from "@antv/l7";
import { Mapbox } from "@antv/l7-maps";
import axios from "axios";
export default {
  data() {
    return {
      map: [],
      modelId: localStorage.getItem("modelId"),
      lineArr: [
        [110.478515625, 32.76880048488168],
        [117.68554687499999, 32.76880048488168],
        [117.68554687499999, 37.64903402157866],
        [110.478515625, 37.64903402157866],
      ],
      data: [
        [110.478515625, 32.76880048488168],
        [117.68554687499999, 32.76880048488168],
        [117.68554687499999, 37.64903402157866],
        [110.478515625, 37.64903402157866],
      ],
      lineLayerData: {
        type: "FeatureCollection",
        features: [
          {
            type: "Feature",
            properties: {
              value: -4,
            },
            geometry: {
              type: "LineString",
              coordinates: [
                [129.992999451897, 49.0183980405053],
                [129.980450498577, 48.9923510625001],
                [129.909393225139, 48.7647809632214],
                [129.85172322427, 48.6014684321538],
                [129.785581224762, 48.4362207725499],
                [129.716246088983, 48.2827489975463],
                [129.652284811936, 48.1630028764023],
                [129.571896344326, 48.0339470933563],
                [129.485969527547, 47.9121574000067],
                [129.396731492436, 47.8009801052651],
                [129.306207534826, 47.7030847086111],
                [129.216267803387, 47.6202033677476],
                [129.128578401883, 47.5531999078445],
                [129.034945812975, 47.496683159286],
                [128.916653967432, 47.4408399743288],
                [128.801664243799, 47.3999696153427],
                [128.68665582401, 47.3709646898426],
                [128.555716124807, 47.3511874816503],
                [128.385510698235, 47.3448767031366],
                [128.261013694609, 47.3529579234525],
                [128.095678387438, 47.3789684493252],
                [127.937879886922, 47.4180952817245],
                [127.793291049333, 47.4640589995898],
                [127.63819687755, 47.52144826696],
                [127.074535030412, 47.7551786983116],
                [126.790272723766, 47.8671942097335],
                [126.486698301348, 47.979580783645],
                [126.227329869401, 48.0692673063646],
                [125.999359517253, 48.1394350149985],
                [125.78962784307, 48.1935719589572],
                [125.599812853448, 48.2331970655961],
                [125.322233195767, 48.277469244854],
                [125.062128711702, 48.307849182332],
                [124.545604513264, 48.34749622412],
                [123.806530016168, 48.381329762274],
                [123.32803776415, 48.3888380532967],
                [123.039780448623, 48.3745158215719],
                [122.804084666062, 48.3415307085546],
                [122.625622442962, 48.2972115373212],
                [122.459974406663, 48.2359900131995],
                [122.328169781817, 48.169905479974],
                [122.201949502369, 48.0888411694772],
                [122.086376375127, 47.9963032968395],
                [121.973050897244, 47.8852974052826],
                [121.868845606777, 47.7641754907017],
                [121.757079070834, 47.6158135729672],
                [121.637608978695, 47.4401985215482],
                [121.296558862253, 46.9129253864927],
                [121.175138351364, 46.7441369917846],
                [121.053837389723, 46.5921069301478],
                [120.897056367303, 46.4184614057303],
                [120.729875644996, 46.256810461277],
                [120.543926327795, 46.1000548270583],
                [120.340110710036, 45.948215637523],
                [120.147238794849, 45.8168970207997],
                [119.938519987381, 45.6834772965551],
                [119.442734003963, 45.3900786888957],
                [119.000692507786, 45.1482464787168],
                [117.981287208941, 44.612889445959],
                [117.729449471963, 44.4905732411118],
                [117.496351548053, 44.3911019829176],
                [117.285529510611, 44.3118901441069],
                [116.80088595507, 44.1424704943613],
                [116.610546142832, 44.0683710799447],
                [116.441547106538, 43.9861136478827],
                [116.374823897345, 43.9450974076198],
                [116.309250304849, 43.8970773803843],
                [116.246642241738, 43.8409754534958],
                [116.191913509797, 43.7799630902247],
                [116.142437863556, 43.7102765036791],
                [116.101530638761, 43.6365185770369],
                [116.071612723716, 43.5690495318597],
                [116.034878069443, 43.463560580879],
                [115.946550233876, 43.1105470317461],
                [115.899739288477, 42.9615124992988],
                [115.87153458105, 42.9045092477801],
                [115.835215872907, 42.8533475292114],
                [115.800998586494, 42.8242672957973],
                [115.76268626266, 42.8088072645617],
                [115.719761917835, 42.8036958246898],
                [115.683563224267, 42.8055264691848],
                [115.589939082165, 42.8281743529847],
                [115.138914109086, 43.0343870806359],
                [114.989178112199, 43.1164645284297],
                [114.859020131522, 43.2106241516197],
                [114.690756717825, 43.3519233263312],
                [114.183282455074, 43.8288842694011],
                [113.991278374417, 44.0008620107017],
                [113.84828618547, 44.1182579662869],
                [113.682701597171, 44.2415558968497],
                [113.418396058983, 44.4196142877885],
                [113.140746094348, 44.5878913634149],
                [112.906977873802, 44.7177057015829],
                [112.477600851373, 44.9397542144019],
                [112.260375451897, 45.0602230405186],
              ],
            },
          },
          {
            type: "Feature",
            properties: {
              value: -2,
            },
            geometry: {
              type: "LineString",
              coordinates: [
                [97.7442894518974, 42.7103170405185],
                [97.6216794436143, 42.4803133501607],
                [97.5179477191999, 42.25593427288],
                [97.4411327136611, 42.1075385823127],
                [97.3457291370641, 41.9510988999743],
                [97.2873706554602, 41.8781613859048],
                [97.2425852343424, 41.834195456856],
                [97.1948173602439, 41.7974405906851],
                [97.1402797051384, 41.7660426430709],
                [97.0866892865082, 41.7448509849997],
                [97.0393008194242, 41.7335826379356],
                [96.9952772896213, 41.729177292835],
                [96.9270629151924, 41.7330630801154],
                [96.8580509161351, 41.7466338454784],
                [96.744815610031, 41.7869026720745],
                [96.6258450418415, 41.8492875568664],
                [96.4743646266465, 41.9482132411746],
                [96.3322145269236, 42.0585667040494],
                [96.2283947853802, 42.1471909855313],
                [96.1230139954814, 42.2458699963462],
                [95.8470138262468, 42.5253470200601],
                [95.5836853452413, 42.7786228064314],
                [95.2944096599341, 43.0730268533187],
                [95.1415749630242, 43.2180297429867],
                [95.040349151537, 43.305215571867],
                [94.9599297333746, 43.3656116561415],
                [94.8746074921112, 43.4182934000933],
                [94.7733443672059, 43.4653869804916],
                [94.6710116705117, 43.4992851397154],
                [94.5643391191702, 43.5228187039],
                [94.3830992566367, 43.5404622288271],
                [94.2435186419932, 43.5402289489768],
                [94.0375968465801, 43.5307877906984],
                [93.5035023802764, 43.4889599337474],
                [93.3186358002788, 43.4808872897157],
                [93.11119801476, 43.4894046607869],
                [92.9918488683105, 43.5067066775022],
                [92.9029704556157, 43.5268077408013],
                [92.8163827147332, 43.5528170524116],
                [92.7270447603592, 43.5865474228263],
                [92.5511732000979, 43.6731262698755],
                [92.3696187458852, 43.7868710322119],
                [91.9392694314827, 44.0955231840248],
                [91.7180314825554, 44.2397410983084],
                [91.5996513262448, 44.3075279179715],
                [91.4610660487048, 44.3786232570494],
                [91.3228173669759, 44.4410050359045],
                [91.1968225867395, 44.4902460937667],
                [91.0605789014588, 44.535450227145],
                [90.9198944410066, 44.5743778565551],
                [90.7687375528539, 44.6082630663306],
                [90.6267815842828, 44.6335780281503],
                [90.4755960802249, 44.654090717318],
                [90.3095711074593, 44.6700834085486],
                [89.6998083630234, 44.7113025660243],
                [89.5226517492956, 44.7357043251152],
                [89.369453108018, 44.766723156558],
                [89.1463721982209, 44.828420443677],
                [88.9125517745103, 44.9130160413084],
                [88.6880430558811, 45.0133268733198],
                [88.4945366510967, 45.1192986576539],
                [88.2754951110036, 45.2647911944723],
                [88.0434801179044, 45.4494690484901],
                [87.9268566829239, 45.563915161748],
                [87.8819476494857, 45.6205147578822],
                [87.8354533844314, 45.6897063823985],
                [87.7868125882788, 45.7767191709562],
                [87.7444672001746, 45.8691619631448],
                [87.7069495969106, 45.9707255938221],
                [87.6736845958791, 46.0831997749112],
                [87.6457345160236, 46.2059658644799],
                [87.6264042223489, 46.3267985997008],
                [87.6159117392086, 46.4434107132041],
                [87.6142218858384, 46.5434664858087],
                [87.6255541841673, 46.6577408994261],
                [87.6476400768939, 46.7535179642483],
                [87.6844246703544, 46.8553703309518],
                [87.7360063735706, 46.9554935621682],
                [87.8055630223334, 47.0582055191037],
                [87.8958106294701, 47.1701663902284],
                [88.2494235284901, 47.5704133498345],
                [88.3510357722085, 47.6959802169723],
                [88.4359803904494, 47.8114763369581],
                [88.5242065875558, 47.9506270435321],
                [88.5818591170566, 48.0655484277879],
                [88.6120273060427, 48.160294512927],
                [88.6130459226127, 48.1824899941558],
                [88.6029884518974, 48.2017640405035],
              ],
            },
          },
        ],
      },
    };
  },
  mounted() {
    // 初始化 场景
    const scene = new Scene({
      id: "container",
      map: new Mapbox({
        style: "dark",
        center: [129.992999451897, 49.0183980405053], //地图中心点的经纬坐标
        pitch: 0, //看地图的仰角
        zoom: 6, //放大比例
      }),
    });
    axios
      .get(
        "https://gw.alipayobjects.com/os/basement_prod/9f6afbcd-3aec-4a26-bd4a-2276d3439e0d.json"
      )
      .then((res) => {
        console.log(res.data, "---");
        scene
          .LineLayer({
            zIndex: 2,
          })
          .source(res.data.datas)
          .shape("line")
          .size("value", [1, 4])
          .color(
            "value",
            ["#ca0020", "#f4a582", "#f7f7f7", "#92c5de", "#0571b0"].reverse()
          )
          .render();
      });
    axios.get(
      "https://gw.alipayobjects.com/os/basement_prod/9f6afbcd-3aec-4a26-bd4a-2276d3439e0d.json",
      function (data) {
        scene
          .LineLayer({
            zIndex: 2,
          })
          .source(data)
          .shape("line")
          .size("value", [1, 4])
          .color(
            "value",
            ["#ca0020", "#f4a582", "#f7f7f7", "#92c5de", "#0571b0"].reverse()
          )
          .render();
      }
    );
    // scene.on("loaded", function () {
    //   const layer = new L7.LineLayer({ zIndex: 0 })
    //     .source(lineLayerData)
    //     .size(1.5)
    //     .shape("line")
    //     .color("#25d8b7")
    //     .animate({
    //       interval: 1, // 间隔
    //       duration: 1, // 持续时间，延时
    //       trailLength: 2, // 流线长度
    //     });
    //   layer.style({
    //     opacity: 0.5,
    //   });
    //   scene.addLayer(layer);
    // });
    // axios
    //   .get(
    //     "https://gw.alipayobjects.com/os/basement_prod/9f6afbcd-3aec-4a26-bd4a-2276d3439e0d.json"
    //   )
    //   .then((res) => {
    //     scene
    //       .LineLayer({
    //         zIndex: 2,
    //       })
    //       .source(data)
    //       .shape("line")
    //       .size("value", [1, 4])
    //       .color(
    //         "value",
    //         ["#ca0020", "#f4a582", "#f7f7f7", "#92c5de", "#0571b0"].reverse()
    //       )
    //       .render();
    //   });

    // scene.on("loaded", () => {
    //   const pointLayer = new PointLayer({})
    //     .source(this.data, {
    //       parser: {
    //         type: "json",
    //         x: "x",
    //         y: "y",
    //       },
    //     })
    //     .shape("circle")
    //     .active(true)
    //     .size("size", (size) => {
    //       return size;
    //     })
    //     .color("color")
    //     .style({
    //       opacity: 0.5,
    //     });
    //   pointLayer.on("mousemove", (e) => {
    //     const popup = new Popup({
    //       offsets: [0, 0],
    //       closeButton: false,
    //       background: "#333",
    //     })
    //       .setLnglat(e.lngLat)
    //       .setHTML(
    //         `<span style="color:${e.feature.color}">${e.feature.name}: ${e.feature.value}</span>`
    //       );
    //     scene.addPopup(popup);
    //   });
    //   scene.addLayer(pointLayer);
    // });
    this.getList();
    // this.map = new AMap.Map("container", {
    //   zoom: 11, //级别
    //   center: [110.478515625, 32.76880048488168], //中心点坐标
    //   viewMode: "3D", //使用3D视图
    // });
    // //绘制轨迹

    // this.polyline = new AMap.Polyline({
    //   map: this.map,
    //   path: this.lineArr, // 这里是轨迹的坐标拼成的数组
    //   showDir: true,
    //   strokeColor: "#28F", //线颜色
    //   // strokeOpacity: 1,   //线透明度
    //   strokeWeight: 6, //线宽
    //   // strokeStyle: "solid" //线样式
    // });
    // var passedPolyline = new AMap.Polyline({
    //   map: this.map,
    //   strokeColor: "#AF5", //线颜色
    //   //path: this.lineArr,
    //   // strokeOpacity: 1,   //线透明度
    //   strokeWeight: 6, //线宽
    //   // strokeStyle: "solid" //线样式
    // });
    // // this.marker.on("moving", function (e) {
    // //   passedPolyline.setPath(e.passedPath);
    // // });
    // this.map.setFitView(); //自动调整到合适的位置
  },
  methods: {
    // 返回
    back() {
      this.$router.push("/app/apply/hydraulic");
    },
    getList() {
      let obj = {
        modelId: this.modelId,
      };
      findGuidesInfo(obj).then((res) => {
        console.log(res);
      });
    },
  },
};
</script>
<style lang="scss">
.ampshow {
  width: 100%;
  height: 100%;
  position: relative;
  p {
    margin: 0;
    font-size: 23px;
    padding: 10px 0;
    font-weight: 700;
  }
}
#container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  margin: 0;
  font-family: "微软雅黑";
}
</style>